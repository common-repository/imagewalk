!function r(o,s,h){function c(e,t){if(!s[e]){if(!o[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var n=s[e]={exports:{}};o[e][0].call(n.exports,function(t){return c(o[e][1][t]||t)},n,n.exports,r,o,s,h)}return s[e].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)c(h[t]);return c}({1:[function(d,t,e){(function(t){"use strict";var i="undefined"!=typeof window?window.imagewalk:void 0!==t?t.imagewalk:null,e="undefined"!=typeof window?window.imagewalk_data:void 0!==t?t.imagewalk_data:null,a=n(d("cropperjs"));function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s=(0,n(d("pica")).default)(),o=e.ajax_url,h=+e.img_width,c=+e.img_height,l=e.uploader.template,u=function(){function e(){var t=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),i.hooks.addAction("upload_open","uploader",function(){return t.onOpen()})}return function(t,e,i){e&&r(t.prototype,e),i&&r(t,i)}(e,[{key:"init",value:function(){var e=this;if(!this.$elem){var t=document.createElement("div");t.innerHTML=l.trim(),this.$elem=t.firstChild,this.$file=this.$elem.querySelector("[data-id=file]"),this.$image=this.$elem.querySelector("[data-id=image]"),this.$canvas=this.$elem.querySelector("[data-id=canvas]"),this.$caption=this.$elem.querySelector("[data-id=caption]"),this.$step1=this.$elem.querySelector('[data-step="1"]'),this.$step2=this.$elem.querySelector('[data-step="2"]'),this.$btnFlip=this.$elem.querySelector("[data-btn=flip]"),this.$btnRotate=this.$elem.querySelector("[data-btn=rotate]"),this.$btnCrop=this.$elem.querySelector("[data-btn=crop]"),this.$btnUndo=this.$elem.querySelector("[data-btn=undo]"),this.$btnSubmit=this.$elem.querySelector("[data-btn=submit]"),this.$btnClose=this.$elem.querySelector("[data-btn=close]"),this.$file.addEventListener("change",function(){return e.onSelectFile()}),this.$btnFlip.addEventListener("click",function(){return e.flip()}),this.$btnRotate.addEventListener("click",function(){return e.rotate()}),this.$btnCrop.addEventListener("click",function(){return e.onConfirm()}),this.$btnUndo.addEventListener("click",function(){return e.onUndo()}),this.$btnSubmit.addEventListener("click",function(){return e.onSubmit()}),this.$btnClose.addEventListener("click",function(t){return e.onClose(t)}),document.body.appendChild(this.$elem)}}},{key:"show",value:function(){this.init(),this.$step1.style.display="",this.$step2.style.display="none",this.$elem.style.display="block",this._documentOverflow=document.body.style.overflow,document.body.style.overflow="hidden"}},{key:"hide",value:function(){this.$elem&&(this.$elem.style.display="",this.reset(),document.body.style.overflow=this._documentOverflow,delete this._documentOverflow)}},{key:"reset",value:function(){this.imgType=null,this.imgCanvas=null,this.cropper&&(this.cropper.destroy(),this.cropper=null,this.cropperFlip=null,this.$image.innerHTML="",this.$canvas.innerHTML="",this.$caption.value="")}},{key:"flip",value:function(){this.cropper&&(this.cropperFlip=0-(this.cropperFlip||1),this.cropper.scaleX(this.cropperFlip))}},{key:"rotate",value:function(){this.cropper&&this.cropper.rotate(90)}},{key:"crop",value:function(){this.cropper}},{key:"maybeResize",value:function(r,o){return new Promise(function(i){var t,e,a=r.naturalWidth,n=r.naturalHeight;1024<!Math.max(a,n)?i(r):(e=1024/Math.max(a,n),(t=document.createElement("canvas")).width=e*a,t.height=e*n,s.resize(r,t).then(function(t){return s.toBlob(t,o,1)}).then(function(t){var e=new Image;e.onload=function(){i(e)},e.src=URL.createObjectURL(t)}))})}},{key:"onOpen",value:function(){this.init(),this.$file.click()}},{key:"onClose",value:function(t){t.stopPropagation(),this.hide()}},{key:"onSelectFile",value:function(){var e,i=this,t=this.$file.files[0];t&&(this.show(),this.imgType=t.type,-1===["image/png","image/jpeg"].indexOf(this.imgType)&&(this.imgType="image/png"),(e=new FileReader).addEventListener("load",function(){var t=new Image;t.onload=function(){i.maybeResize(t,i.imgType).then(function(t){i.$file.form.reset(),i.$image.innerHTML="",i.$image.appendChild(t),i.$image.style.display="block",i.cropper=new a.default(t,{aspectRatio:1,background:!1,center:!1,cropBoxMovable:!1,cropBoxResizable:!1,dragMode:"move",minCropBoxWidth:h,toggleDragModeOnDblclick:!1,viewMode:3})})},t.src=e.result}),e.readAsDataURL(t))}},{key:"onConfirm",value:function(){if(this.cropper){this.imgCanvas=this.cropper.getCroppedCanvas({width:h,height:c});var t=document.createElement("canvas");t.width=h,t.height=c,t.getContext("2d").drawImage(this.imgCanvas,0,0),this.$canvas.innerHTML="",this.$canvas.appendChild(t),this.$canvas.style.display="block",this.$step1.style.display="none",this.$step2.style.display=""}}},{key:"onUndo",value:function(){this.imgCanvas=null,this.$step2.style.display="none",this.$step1.style.display=""}},{key:"onSubmit",value:function(){var e=this;if(this.imgCanvas){var t={action:"imagewalk_upload",caption:this.$caption.value.trim(),img:this.imgCanvas.toDataURL(this.imgType,1)};i.ajax.post({url:o,data:t,success:function(t){return e.onSubmitSuccess(t)},error:function(){return e.onSubmitError()}})}}},{key:"onSubmitSuccess",value:function(t){this.hide(),i.hooks.doAction("upload_success",t)}},{key:"onSubmitError",value:function(){console.log("onSubmitError")}}]),e}();i.hooks.addAction("init","init_uploader",function(){new u})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{cropperjs:2,pica:14}],2:[function(t,e,i){var a,n;a=this,n=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function N(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var n="undefined"!=typeof window&&void 0!==window.document,o=n?window:{},t=n&&"ontouchstart"in o.document.documentElement,i=n&&"PointerEvent"in o,l="cropper",C="n",B="ne",x="nw",E="se",_="sw",s="".concat(l,"-crop"),r="".concat(l,"-disabled"),M="".concat(l,"-hidden"),u="".concat(l,"-hide"),d="".concat(l,"-invisible"),h="".concat(l,"-modal"),p="".concat(l,"-move"),g="".concat(l,"Action"),f="".concat(l,"Preview"),c="crop",m="crop",A="cropend",v="cropmove",w="cropstart",b="dblclick",y=i?"pointerdown":t?"touchstart":"mousedown",I=i?"pointermove":t?"touchmove":"mousemove",Q=i?"pointerup pointercancel":t?"touchend touchcancel":"mouseup",D="zoom",k="image/jpeg",H=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,L=/^data:/,U=/^data:image\/jpeg;base64,/,O=/^img|canvas$/i,R={viewMode:0,dragMode:c,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},S=Number.isNaN||o.isNaN;function W(t){return"number"==typeof t&&!S(t)}var q=function(t){return 0<t&&t<1/0};function T(t){return void 0===t}function z(t){return"object"===e(t)&&null!==t}var Y=Object.prototype.hasOwnProperty;function j(t){if(!z(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&Y.call(i,"isPrototypeOf")}catch(t){return!1}}function X(t){return"function"==typeof t}var G=Array.prototype.slice;function F(t){return Array.from?Array.from(t):G.call(t)}function P(i,a){return i&&X(a)&&(Array.isArray(i)||W(i.length)?F(i).forEach(function(t,e){a.call(i,t,e,i)}):z(i)&&Object.keys(i).forEach(function(t){a.call(i,i[t],t,i)})),i}var $=Object.assign||function(i){for(var t=arguments.length,e=new Array(1<t?t-1:0),a=1;a<t;a++)e[a-1]=arguments[a];return z(i)&&0<e.length&&e.forEach(function(e){z(e)&&Object.keys(e).forEach(function(t){i[t]=e[t]})}),i},Z=/\.\d*(?:0|9){12}\d*$/;function K(t,e){var i=1<arguments.length&&void 0!==e?e:1e11;return Z.test(t)?Math.round(t*i)/i:t}var J=/^width|height|left|top|marginLeft|marginTop$/;function V(t,e){var i=t.style;P(e,function(t,e){J.test(e)&&W(t)&&(t="".concat(t,"px")),i[e]=t})}function tt(t,e){if(e)if(W(t.length))P(t,function(t){tt(t,e)});else if(t.classList)t.classList.add(e);else{var i=t.className.trim();i?i.indexOf(e)<0&&(t.className="".concat(i," ").concat(e)):t.className=e}}function et(t,e){e&&(W(t.length)?P(t,function(t){et(t,e)}):t.classList?t.classList.remove(e):0<=t.className.indexOf(e)&&(t.className=t.className.replace(e,"")))}function it(t,e,i){e&&(W(t.length)?P(t,function(t){it(t,e,i)}):i?tt(t,e):et(t,e))}var at=/([a-z\d])([A-Z])/g;function nt(t){return t.replace(at,"$1-$2").toLowerCase()}function rt(t,e){return z(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-".concat(nt(e)))}function ot(t,e,i){z(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-".concat(nt(e)),i)}var st=/\s\s*/,ht=function(){var t=!1;if(n){var e=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(t){e=t}});o.addEventListener("test",i,a),o.removeEventListener("test",i,a)}return t}();function ct(i,t,a,e){var n=3<arguments.length&&void 0!==e?e:{},r=a;t.trim().split(st).forEach(function(t){if(!ht){var e=i.listeners;e&&e[t]&&e[t][a]&&(r=e[t][a],delete e[t][a],0===Object.keys(e[t]).length&&delete e[t],0===Object.keys(e).length&&delete i.listeners)}i.removeEventListener(t,r,n)})}function lt(r,t,o,e){var s=3<arguments.length&&void 0!==e?e:{},h=o;t.trim().split(st).forEach(function(a){if(s.once&&!ht){var t=r.listeners,n=void 0===t?{}:t;h=function(){delete n[a][o],r.removeEventListener(a,h,s);for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];o.apply(r,e)},n[a]||(n[a]={}),n[a][o]&&r.removeEventListener(a,n[a][o],s),n[a][o]=h,r.listeners=n}r.addEventListener(a,h,s)})}function ut(t,e,i){var a;return X(Event)&&X(CustomEvent)?a=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,i),t.dispatchEvent(a)}function dt(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var pt=o.location,gt=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ft(t){var e=t.match(gt);return null!==e&&(e[1]!==pt.protocol||e[2]!==pt.hostname||e[3]!==pt.port)}function mt(t){var e="timestamp=".concat((new Date).getTime());return t+(-1===t.indexOf("?")?"?":"&")+e}function At(t){var e=t.rotate,i=t.scaleX,a=t.scaleY,n=t.translateX,r=t.translateY,o=[];W(n)&&0!==n&&o.push("translateX(".concat(n,"px)")),W(r)&&0!==r&&o.push("translateY(".concat(r,"px)")),W(e)&&0!==e&&o.push("rotate(".concat(e,"deg)")),W(i)&&1!==i&&o.push("scaleX(".concat(i,")")),W(a)&&1!==a&&o.push("scaleY(".concat(a,")"));var s=o.length?o.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function vt(t,e){var i=t.pageX,a=t.pageY,n={endX:i,endY:a};return e?n:$({startX:i,startY:a},n)}function wt(t,e){var i=t.aspectRatio,a=t.height,n=t.width,r=1<arguments.length&&void 0!==e?e:"contain",o=q(n),s=q(a);if(o&&s){var h=a*i;"contain"===r&&n<h||"cover"===r&&h<n?a=n/i:n=a*i}else o?a=n/i:s&&(n=a*i);return{width:n,height:a}}var bt=String.fromCharCode;var yt=/^data:.*,/;function It(t){var e,i=new DataView(t);try{var a,n,r;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var o=i.byteLength,s=2;s+1<o;){if(255===i.getUint8(s)&&225===i.getUint8(s+1)){n=s;break}s+=1}if(n){var h=n+10;if("Exif"===function(t,e,i){var a="";i+=e;for(var n=e;n<i;n+=1)a+=bt(t.getUint8(n));return a}(i,n+4,4)){var c=i.getUint16(h);if(((a=18761===c)||19789===c)&&42===i.getUint16(h+2,a)){var l=i.getUint32(h+4,a);8<=l&&(r=h+l)}}}if(r){var u,d,p=i.getUint16(r,a);for(d=0;d<p;d+=1)if(u=r+12*d+2,274===i.getUint16(u,a)){u+=8,e=i.getUint16(u,a),i.setUint16(u,1,a);break}}}catch(t){e=1}return e}var Ct={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,i=this.container,a=this.cropper;tt(a,M),et(t,M);var n={width:Math.max(i.offsetWidth,Number(e.minContainerWidth)||200),height:Math.max(i.offsetHeight,Number(e.minContainerHeight)||100)};V(a,{width:(this.containerData=n).width,height:n.height}),tt(t,M),et(a,M)},initCanvas:function(){var t=this.containerData,e=this.imageData,i=this.options.viewMode,a=Math.abs(e.rotate)%180==90,n=a?e.naturalHeight:e.naturalWidth,r=a?e.naturalWidth:e.naturalHeight,o=n/r,s=t.width,h=t.height;t.height*o>t.width?3===i?s=t.height*o:h=t.width/o:3===i?h=t.width/o:s=t.height*o;var c={aspectRatio:o,naturalWidth:n,naturalHeight:r,width:s,height:h};c.left=(t.width-s)/2,c.top=(t.height-h)/2,c.oldLeft=c.left,c.oldTop=c.top,this.canvasData=c,this.limited=1===i||2===i,this.limitCanvas(!0,!0),this.initialImageData=$({},e),this.initialCanvasData=$({},c)},limitCanvas:function(t,e){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,o=i.viewMode,s=n.aspectRatio,h=this.cropped&&r;if(t){var c=Number(i.minCanvasWidth)||0,l=Number(i.minCanvasHeight)||0;1<o?(c=Math.max(c,a.width),l=Math.max(l,a.height),3===o&&(c<l*s?c=l*s:l=c/s)):0<o&&(c?c=Math.max(c,h?r.width:0):l?l=Math.max(l,h?r.height:0):h&&((c=r.width)<(l=r.height)*s?c=l*s:l=c/s));var u=wt({aspectRatio:s,width:c,height:l});c=u.width,l=u.height,n.minWidth=c,n.minHeight=l,n.maxWidth=1/0,n.maxHeight=1/0}if(e)if((h?0:1)<o){var d=a.width-n.width,p=a.height-n.height;n.minLeft=Math.min(0,d),n.minTop=Math.min(0,p),n.maxLeft=Math.max(0,d),n.maxTop=Math.max(0,p),h&&this.limited&&(n.minLeft=Math.min(r.left,r.left+(r.width-n.width)),n.minTop=Math.min(r.top,r.top+(r.height-n.height)),n.maxLeft=r.left,n.maxTop=r.top,2===o&&(n.width>=a.width&&(n.minLeft=Math.min(0,d),n.maxLeft=Math.max(0,d)),n.height>=a.height&&(n.minTop=Math.min(0,p),n.maxTop=Math.max(0,p))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=a.width,n.maxTop=a.height},renderCanvas:function(t,e){var i=this.canvasData,a=this.imageData;if(e){var n=function(t){var e=t.width,i=t.height,a=t.degree;if(90===(a=Math.abs(a)%180))return{width:i,height:e};var n=a%90*Math.PI/180,r=Math.sin(n),o=Math.cos(n),s=e*o+i*r,h=e*r+i*o;return 90<a?{width:h,height:s}:{width:s,height:h}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),r=n.width,o=n.height,s=i.width*(r/i.naturalWidth),h=i.height*(o/i.naturalHeight);i.left-=(s-i.width)/2,i.top-=(h-i.height)/2,i.width=s,i.height=h,i.aspectRatio=r/o,i.naturalWidth=r,i.naturalHeight=o,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,V(this.canvas,$({width:i.width,height:i.height},At({translateX:i.left,translateY:i.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,i=this.imageData,a=i.naturalWidth*(e.width/e.naturalWidth),n=i.naturalHeight*(e.height/e.naturalHeight);$(i,{width:a,height:n,left:(e.width-a)/2,top:(e.height-n)/2}),V(this.image,$({width:i.width,height:i.height},At($({translateX:i.left,translateY:i.top},i)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,i=t.aspectRatio||t.initialAspectRatio,a=Number(t.autoCropArea)||.8,n={width:e.width,height:e.height};i&&(e.height*i>e.width?n.height=n.width/i:n.width=n.height*i),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*a),n.height=Math.max(n.minHeight,n.height*a),n.left=e.left+(e.width-n.width)/2,n.top=e.top+(e.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=$({},n)},limitCropBox:function(t,e){var i=this.options,a=this.containerData,n=this.canvasData,r=this.cropBoxData,o=this.limited,s=i.aspectRatio;if(t){var h=Number(i.minCropBoxWidth)||0,c=Number(i.minCropBoxHeight)||0,l=o?Math.min(a.width,n.width,n.width+n.left,a.width-n.left):a.width,u=o?Math.min(a.height,n.height,n.height+n.top,a.height-n.top):a.height;h=Math.min(h,a.width),c=Math.min(c,a.height),s&&(h&&c?h<c*s?c=h/s:h=c*s:h?c=h/s:c&&(h=c*s),l<u*s?u=l/s:l=u*s),r.minWidth=Math.min(h,l),r.minHeight=Math.min(c,u),r.maxWidth=l,r.maxHeight=u}e&&(o?(r.minLeft=Math.max(0,n.left),r.minTop=Math.max(0,n.top),r.maxLeft=Math.min(a.width,n.left+n.width)-r.width,r.maxTop=Math.min(a.height,n.top+n.height)-r.height):(r.minLeft=0,r.minTop=0,r.maxLeft=a.width-r.width,r.maxTop=a.height-r.height))},renderCropBox:function(){var t=this.options,e=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,t.movable&&t.cropBoxMovable&&ot(this.face,g,i.width>=e.width&&i.height>=e.height?"move":"all"),V(this.cropBox,$({width:i.width,height:i.height},At({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ut(this.element,m,this.getData())}},Bt={initPreview:function(){var t=this.element,i=this.crossOrigin,e=this.options.preview,a=i?this.crossOriginUrl:this.url,n=t.alt||"The image to preview",r=document.createElement("img");if(i&&(r.crossOrigin=i),r.src=a,r.alt=n,this.viewBox.appendChild(r),this.viewBoxImage=r,e){var o=e;"string"==typeof e?o=t.ownerDocument.querySelectorAll(e):e.querySelector&&(o=[e]),P(this.previews=o,function(t){var e=document.createElement("img");ot(t,f,{width:t.offsetWidth,height:t.offsetHeight,html:t.innerHTML}),i&&(e.crossOrigin=i),e.src=a,e.alt=n,e.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',t.innerHTML="",t.appendChild(e)})}},resetPreview:function(){P(this.previews,function(t){var e=rt(t,f);V(t,{width:e.width,height:e.height}),t.innerHTML=e.html,function(e,i){if(z(e[i]))try{delete e[i]}catch(t){e[i]=void 0}else if(e.dataset)try{delete e.dataset[i]}catch(t){e.dataset[i]=void 0}else e.removeAttribute("data-".concat(nt(i)))}(t,f)})},preview:function(){var s=this.imageData,t=this.canvasData,e=this.cropBoxData,h=e.width,c=e.height,l=s.width,u=s.height,d=e.left-t.left-s.left,p=e.top-t.top-s.top;this.cropped&&!this.disabled&&(V(this.viewBoxImage,$({width:l,height:u},At($({translateX:-d,translateY:-p},s)))),P(this.previews,function(t){var e=rt(t,f),i=e.width,a=e.height,n=i,r=a,o=1;h&&(r=c*(o=i/h)),c&&a<r&&(n=h*(o=a/c),r=a),V(t,{width:n,height:r}),V(t.getElementsByTagName("img")[0],$({width:l*o,height:u*o},At($({translateX:-d*o,translateY:-p*o},s))))}))}},xt={bind:function(){var t=this.element,e=this.options,i=this.cropper;X(e.cropstart)&&lt(t,w,e.cropstart),X(e.cropmove)&&lt(t,v,e.cropmove),X(e.cropend)&&lt(t,A,e.cropend),X(e.crop)&&lt(t,m,e.crop),X(e.zoom)&&lt(t,D,e.zoom),lt(i,y,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&lt(i,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&lt(i,b,this.onDblclick=this.dblclick.bind(this)),lt(t.ownerDocument,I,this.onCropMove=this.cropMove.bind(this)),lt(t.ownerDocument,Q,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&lt(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,i=this.cropper;X(e.cropstart)&&ct(t,w,e.cropstart),X(e.cropmove)&&ct(t,v,e.cropmove),X(e.cropend)&&ct(t,A,e.cropend),X(e.crop)&&ct(t,m,e.crop),X(e.zoom)&&ct(t,D,e.zoom),ct(i,y,this.onCropStart),e.zoomable&&e.zoomOnWheel&&ct(i,"wheel",this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&ct(i,b,this.onDblclick),ct(t.ownerDocument,I,this.onCropMove),ct(t.ownerDocument,Q,this.onCropEnd),e.responsive&&ct(window,"resize",this.onResize)}},Et={resize:function(){var t=this.options,e=this.container,i=this.containerData,a=Number(t.minContainerWidth)||200,n=Number(t.minContainerHeight)||100;if(!(this.disabled||i.width<=a||i.height<=n)){var r,o,s=e.offsetWidth/i.width;if(1!=s||e.offsetHeight!==i.height)t.restore&&(r=this.getCanvasData(),o=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(P(r,function(t,e){r[e]=t*s})),this.setCropBoxData(P(o,function(t,e){o[e]=t*s})))}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(function(t,e){return t.classList?t.classList.contains(e):-1<t.className.indexOf(e)}(this.dragBox,s)?"move":c)},wheel:function(t){var e=this,i=Number(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){e.wheeling=!1},50),t.deltaY?a=0<t.deltaY?1:-1:t.wheelDelta?a=-t.wheelDelta/120:t.detail&&(a=0<t.detail?1:-1),this.zoom(-a*i,t)))},cropStart:function(t){var e=t.buttons,i=t.button;if(!(this.disabled||W(e)&&1!==e||W(i)&&0!==i||t.ctrlKey)){var a,n=this.options,r=this.pointers;t.changedTouches?P(t.changedTouches,function(t){r[t.identifier]=vt(t)}):r[t.pointerId||0]=vt(t),a=1<Object.keys(r).length&&n.zoomable&&n.zoomOnTouch?"zoom":rt(t.target,g),H.test(a)&&!1!==ut(this.element,w,{originalEvent:t,action:a})&&(t.preventDefault(),this.action=a,this.cropping=!1,"crop"===a&&(this.cropping=!0,tt(this.dragBox,h)))}},cropMove:function(t){var e=this.action;if(!this.disabled&&e){var i=this.pointers;t.preventDefault(),!1!==ut(this.element,v,{originalEvent:t,action:e})&&(t.changedTouches?P(t.changedTouches,function(t){$(i[t.identifier]||{},vt(t,!0))}):$(i[t.pointerId||0]||{},vt(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,i=this.pointers;t.changedTouches?P(t.changedTouches,function(t){delete i[t.identifier]}):delete i[t.pointerId||0],e&&(t.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,it(this.dragBox,h,this.cropped&&this.options.modal)),ut(this.element,A,{originalEvent:t,action:e}))}}},_t={change:function(t){var e,i=this.options,a=this.canvasData,n=this.containerData,r=this.cropBoxData,o=this.pointers,s=this.action,h=i.aspectRatio,c=r.left,l=r.top,u=r.width,d=r.height,p=c+u,g=l+d,f=0,m=0,A=n.width,v=n.height,w=!0;!h&&t.shiftKey&&(h=u&&d?u/d:1),this.limited&&(f=r.minLeft,m=r.minTop,A=f+Math.min(n.width,a.width,a.left+a.width),v=m+Math.min(n.height,a.height,a.top+a.height));function b(t){switch(t){case"e":p+I.x>A&&(I.x=A-p);break;case"w":c+I.x<f&&(I.x=f-c);break;case C:l+I.y<m&&(I.y=m-l);break;case"s":g+I.y>v&&(I.y=v-g)}}var y=o[Object.keys(o)[0]],I={x:y.endX-y.startX,y:y.endY-y.startY};switch(s){case"all":c+=I.x,l+=I.y;break;case"e":if(0<=I.x&&(A<=p||h&&(l<=m||v<=g))){w=!1;break}b("e"),(u+=I.x)<0&&(s="w",c-=u=-u),h&&(d=u/h,l+=(r.height-d)/2);break;case C:if(I.y<=0&&(l<=m||h&&(c<=f||A<=p))){w=!1;break}b(C),d-=I.y,l+=I.y,d<0&&(s="s",l-=d=-d),h&&(u=d*h,c+=(r.width-u)/2);break;case"w":if(I.x<=0&&(c<=f||h&&(l<=m||v<=g))){w=!1;break}b("w"),u-=I.x,c+=I.x,u<0&&(s="e",c-=u=-u),h&&(d=u/h,l+=(r.height-d)/2);break;case"s":if(0<=I.y&&(v<=g||h&&(c<=f||A<=p))){w=!1;break}b("s"),(d+=I.y)<0&&(s=C,l-=d=-d),h&&(u=d*h,c+=(r.width-u)/2);break;case B:if(h){if(I.y<=0&&(l<=m||A<=p)){w=!1;break}b(C),d-=I.y,l+=I.y,u=d*h}else b(C),b("e"),0<=I.x?p<A?u+=I.x:I.y<=0&&l<=m&&(w=!1):u+=I.x,I.y<=0?m<l&&(d-=I.y,l+=I.y):(d-=I.y,l+=I.y);u<0&&d<0?(s=_,l-=d=-d,c-=u=-u):u<0?(s=x,c-=u=-u):d<0&&(s=E,l-=d=-d);break;case x:if(h){if(I.y<=0&&(l<=m||c<=f)){w=!1;break}b(C),d-=I.y,l+=I.y,u=d*h,c+=r.width-u}else b(C),b("w"),I.x<=0?f<c?(u-=I.x,c+=I.x):I.y<=0&&l<=m&&(w=!1):(u-=I.x,c+=I.x),I.y<=0?m<l&&(d-=I.y,l+=I.y):(d-=I.y,l+=I.y);u<0&&d<0?(s=E,l-=d=-d,c-=u=-u):u<0?(s=B,c-=u=-u):d<0&&(s=_,l-=d=-d);break;case _:if(h){if(I.x<=0&&(c<=f||v<=g)){w=!1;break}b("w"),u-=I.x,c+=I.x,d=u/h}else b("s"),b("w"),I.x<=0?f<c?(u-=I.x,c+=I.x):0<=I.y&&v<=g&&(w=!1):(u-=I.x,c+=I.x),0<=I.y?g<v&&(d+=I.y):d+=I.y;u<0&&d<0?(s=B,l-=d=-d,c-=u=-u):u<0?(s=E,c-=u=-u):d<0&&(s=x,l-=d=-d);break;case E:if(h){if(0<=I.x&&(A<=p||v<=g)){w=!1;break}b("e"),d=(u+=I.x)/h}else b("s"),b("e"),0<=I.x?p<A?u+=I.x:0<=I.y&&v<=g&&(w=!1):u+=I.x,0<=I.y?g<v&&(d+=I.y):d+=I.y;u<0&&d<0?(s=x,l-=d=-d,c-=u=-u):u<0?(s=_,c-=u=-u):d<0&&(s=B,l-=d=-d);break;case"move":this.move(I.x,I.y),w=!1;break;case"zoom":this.zoom(function(t){var e=$({},t),h=[];return P(t,function(s,t){delete e[t],P(e,function(t){var e=Math.abs(s.startX-t.startX),i=Math.abs(s.startY-t.startY),a=Math.abs(s.endX-t.endX),n=Math.abs(s.endY-t.endY),r=Math.sqrt(e*e+i*i),o=(Math.sqrt(a*a+n*n)-r)/r;h.push(o)})}),h.sort(function(t,e){return Math.abs(t)<Math.abs(e)}),h[0]}(o),t),w=!1;break;case"crop":if(!I.x||!I.y){w=!1;break}e=dt(this.cropper),c=y.startX-e.left,l=y.startY-e.top,u=r.minWidth,d=r.minHeight,0<I.x?s=0<I.y?E:B:I.x<0&&(c-=u,s=0<I.y?_:x),I.y<0&&(l-=d),this.cropped||(et(this.cropBox,M),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}w&&(r.width=u,r.height=d,r.left=c,r.top=l,this.action=s,this.renderCropBox()),P(o,function(t){t.startX=t.endX,t.startY=t.endY})}},Mt={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&tt(this.dragBox,h),et(this.cropBox,M),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=$({},this.initialImageData),this.canvasData=$({},this.initialCanvasData),this.cropBoxData=$({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&($(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),et(this.dragBox,h),tt(this.cropBox,M)),this},replace:function(e,t){var i=1<arguments.length&&void 0!==t&&t;return!this.disabled&&e&&(this.isImg&&(this.element.src=e),i?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,P(this.previews,function(t){t.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,et(this.cropper,r)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,tt(this.cropper,r)),this},destroy:function(){var t=this.element;return t[l]&&(t[l]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate()),this},move:function(t,e){var i=1<arguments.length&&void 0!==e?e:t,a=this.canvasData,n=a.left,r=a.top;return this.moveTo(T(t)?t:n+Number(t),T(i)?i:r+Number(i))},moveTo:function(t,e){var i=1<arguments.length&&void 0!==e?e:t,a=this.canvasData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(W(t)&&(a.left=t,n=!0),W(i)&&(a.top=i,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,e){var i=this.canvasData;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo:function(t,e,i){var a=this.options,n=this.canvasData,r=n.width,o=n.height,s=n.naturalWidth,h=n.naturalHeight;if(0<=(t=Number(t))&&this.ready&&!this.disabled&&a.zoomable){var c=s*t,l=h*t;if(!1===ut(this.element,D,{ratio:t,oldRatio:r/s,originalEvent:i}))return this;if(i){var u=this.pointers,d=dt(this.cropper),p=u&&Object.keys(u).length?function(t){var a=0,n=0,r=0;return P(t,function(t){var e=t.startX,i=t.startY;a+=e,n+=i,r+=1}),{pageX:a/=r,pageY:n/=r}}(u):{pageX:i.pageX,pageY:i.pageY};n.left-=(c-r)*((p.pageX-d.left-n.left)/r),n.top-=(l-o)*((p.pageY-d.top-n.top)/o)}else j(e)&&W(e.x)&&W(e.y)?(n.left-=(c-r)*((e.x-n.left)/r),n.top-=(l-o)*((e.y-n.top)/o)):(n.left-=(c-r)/2,n.top-=(l-o)/2);n.width=c,n.height=l,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return W(t=Number(t))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,W(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(W(e)?e:1,t)},scale:function(t,e){var i=1<arguments.length&&void 0!==e?e:t,a=this.imageData,n=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(W(t)&&(a.scaleX=t,n=!0),W(i)&&(a.scaleY=i,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(t){var i,e=0<arguments.length&&void 0!==t&&t,a=this.options,n=this.imageData,r=this.canvasData,o=this.cropBoxData;if(this.ready&&this.cropped){i={x:o.left-r.left,y:o.top-r.top,width:o.width,height:o.height};var s=n.width/n.naturalWidth;if(P(i,function(t,e){i[e]=t/s}),e){var h=Math.round(i.y+i.height),c=Math.round(i.x+i.width);i.x=Math.round(i.x),i.y=Math.round(i.y),i.width=c-i.x,i.height=h-i.y}}else i={x:0,y:0,width:0,height:0};return a.rotatable&&(i.rotate=n.rotate||0),a.scalable&&(i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1),i},setData:function(t){var e=this.options,i=this.imageData,a=this.canvasData,n={};if(this.ready&&!this.disabled&&j(t)){var r=!1;e.rotatable&&W(t.rotate)&&t.rotate!==i.rotate&&(i.rotate=t.rotate,r=!0),e.scalable&&(W(t.scaleX)&&t.scaleX!==i.scaleX&&(i.scaleX=t.scaleX,r=!0),W(t.scaleY)&&t.scaleY!==i.scaleY&&(i.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);var o=i.width/i.naturalWidth;W(t.x)&&(n.left=t.x*o+a.left),W(t.y)&&(n.top=t.y*o+a.top),W(t.width)&&(n.width=t.width*o),W(t.height)&&(n.height=t.height*o),this.setCropBoxData(n)}return this},getContainerData:function(){return this.ready?$({},this.containerData):{}},getImageData:function(){return this.sized?$({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,i={};return this.ready&&P(["left","top","width","height","naturalWidth","naturalHeight"],function(t){i[t]=e[t]}),i},setCanvasData:function(t){var e=this.canvasData,i=e.aspectRatio;return this.ready&&!this.disabled&&j(t)&&(W(t.left)&&(e.left=t.left),W(t.top)&&(e.top=t.top),W(t.width)?(e.width=t.width,e.height=t.width/i):W(t.height)&&(e.height=t.height,e.width=t.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var t,e=this.cropBoxData;return this.ready&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(t){var e,i,a=this.cropBoxData,n=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&j(t)&&(W(t.left)&&(a.left=t.left),W(t.top)&&(a.top=t.top),W(t.width)&&t.width!==a.width&&(e=!0,a.width=t.width),W(t.height)&&t.height!==a.height&&(i=!0,a.height=t.height),n&&(e?a.height=a.width/n:i&&(a.width=a.height*n)),this.renderCropBox()),this},getCroppedCanvas:function(t){var e=0<arguments.length&&void 0!==t?t:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,a=function(t,e,i,a){var n=e.aspectRatio,r=e.naturalWidth,o=e.naturalHeight,s=e.rotate,h=void 0===s?0:s,c=e.scaleX,l=void 0===c?1:c,u=e.scaleY,d=void 0===u?1:u,p=i.aspectRatio,g=i.naturalWidth,f=i.naturalHeight,m=a.fillColor,A=void 0===m?"transparent":m,v=a.imageSmoothingEnabled,w=void 0===v||v,b=a.imageSmoothingQuality,y=void 0===b?"low":b,I=a.maxWidth,C=void 0===I?1/0:I,B=a.maxHeight,x=void 0===B?1/0:B,E=a.minWidth,_=void 0===E?0:E,M=a.minHeight,Q=void 0===M?0:M,D=document.createElement("canvas"),k=D.getContext("2d"),H=wt({aspectRatio:p,width:C,height:x}),L=wt({aspectRatio:p,width:_,height:Q},"cover"),U=Math.min(H.width,Math.max(L.width,g)),O=Math.min(H.height,Math.max(L.height,f)),R=wt({aspectRatio:n,width:C,height:x}),S=wt({aspectRatio:n,width:_,height:Q},"cover"),W=Math.min(R.width,Math.max(S.width,r)),q=Math.min(R.height,Math.max(S.height,o)),T=[-W/2,-q/2,W,q];return D.width=K(U),D.height=K(O),k.fillStyle=A,k.fillRect(0,0,U,O),k.save(),k.translate(U/2,O/2),k.rotate(h*Math.PI/180),k.scale(l,d),k.imageSmoothingEnabled=w,k.imageSmoothingQuality=y,k.drawImage.apply(k,[t].concat(N(T.map(function(t){return Math.floor(K(t))})))),k.restore(),D}(this.image,this.imageData,i,e);if(!this.cropped)return a;var n=this.getData(),r=n.x,o=n.y,s=n.width,h=n.height,c=a.width/Math.floor(i.naturalWidth);1!=c&&(r*=c,o*=c,s*=c,h*=c);var l=s/h,u=wt({aspectRatio:l,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),d=wt({aspectRatio:l,width:e.minWidth||0,height:e.minHeight||0},"cover"),p=wt({aspectRatio:l,width:e.width||(1!=c?a.width:s),height:e.height||(1!=c?a.height:h)}),g=p.width,f=p.height;g=Math.min(u.width,Math.max(d.width,g)),f=Math.min(u.height,Math.max(d.height,f));var m=document.createElement("canvas"),A=m.getContext("2d");m.width=K(g),m.height=K(f),A.fillStyle=e.fillColor||"transparent",A.fillRect(0,0,g,f);var v=e.imageSmoothingEnabled,w=void 0===v||v,b=e.imageSmoothingQuality;A.imageSmoothingEnabled=w,b&&(A.imageSmoothingQuality=b);var y,I,C,B,x,E,_=a.width,M=a.height,Q=r,D=o;Q<=-s||_<Q?x=C=y=Q=0:Q<=0?(C=-Q,Q=0,x=y=Math.min(_,s+Q)):Q<=_&&(C=0,x=y=Math.min(s,_-Q)),y<=0||D<=-h||M<D?E=B=I=D=0:D<=0?(B=-D,D=0,E=I=Math.min(M,h+D)):D<=M&&(B=0,E=I=Math.min(h,M-D));var k=[Q,D,y,I];if(0<x&&0<E){var H=g/s;k.push(C*H,B*H,x*H,E*H)}return A.drawImage.apply(A,[a].concat(N(k.map(function(t){return Math.floor(K(t))})))),m},setAspectRatio:function(t){var e=this.options;return this.disabled||T(t)||(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,i=this.dragBox,a=this.face;if(this.ready&&!this.disabled){var n=t===c,r=e.movable&&"move"===t;t=n||r?t:"none",e.dragMode=t,ot(i,g,t),it(i,s,n),it(i,p,r),e.cropBoxMovable||(ot(a,g,t),it(a,s,n),it(a,p,r))}return this}},Qt=o.Cropper,Dt=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),!t||!O.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=$({},R,j(e)&&e),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return function(t,e,i){e&&a(t.prototype,e),i&&a(t,i)}(i,[{key:"init",value:function(){var t,e=this.element,i=e.tagName.toLowerCase();if(!e[l]){if(e[l]=this,"img"===i){if(this.isImg=!0,t=e.getAttribute("src")||"",!(this.originalUrl=t))return;t=e.src}else"canvas"===i&&window.HTMLCanvasElement&&(t=e.toDataURL());this.load(t)}}},{key:"load",value:function(t){var e=this;if(t){this.url=t,this.imageData={};var i=this.element,a=this.options;if(a.rotatable||a.scalable||(a.checkOrientation=!1),a.checkOrientation&&window.ArrayBuffer)if(L.test(t))U.test(t)?this.read(function(t){var e=t.replace(yt,""),i=atob(e),a=new ArrayBuffer(i.length),n=new Uint8Array(a);return P(n,function(t,e){n[e]=i.charCodeAt(e)}),a}(t)):this.clone();else{var n=new XMLHttpRequest,r=this.clone.bind(this);this.reloading=!0,(this.xhr=n).onabort=r,n.onerror=r,n.ontimeout=r,n.onprogress=function(){n.getResponseHeader("content-type")!==k&&n.abort()},n.onload=function(){e.read(n.response)},n.onloadend=function(){e.reloading=!1,e.xhr=null},a.checkCrossOrigin&&ft(t)&&i.crossOrigin&&(t=mt(t)),n.open("GET",t),n.responseType="arraybuffer",n.withCredentials="use-credentials"===i.crossOrigin,n.send()}else this.clone()}}},{key:"read",value:function(t){var e=this.options,i=this.imageData,a=It(t),n=0,r=1,o=1;if(1<a){this.url=function(t,e){for(var i=[],a=new Uint8Array(t);0<a.length;)i.push(bt.apply(null,F(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(i.join("")))}(t,k);var s=function(t){var e=0,i=1,a=1;switch(t){case 2:i=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}return{rotate:e,scaleX:i,scaleY:a}}(a);n=s.rotate,r=s.scaleX,o=s.scaleY}e.rotatable&&(i.rotate=n),e.scalable&&(i.scaleX=r,i.scaleY=o),this.clone()}},{key:"clone",value:function(){var t=this.element,e=this.url,i=t.crossOrigin,a=e;this.options.checkCrossOrigin&&ft(e)&&(i=i||"anonymous",a=mt(e)),this.crossOrigin=i,this.crossOriginUrl=a;var n=document.createElement("img");i&&(n.crossOrigin=i),n.src=a||e,n.alt=t.alt||"The image to crop",(this.image=n).onload=this.start.bind(this),n.onerror=this.stop.bind(this),tt(n,u),t.parentNode.insertBefore(n,t.nextSibling)}},{key:"start",value:function(){var i=this,t=this.image;t.onload=null,t.onerror=null,this.sizing=!0;function e(t,e){$(i.imageData,{naturalWidth:t,naturalHeight:e,aspectRatio:t/e}),i.sizing=!1,i.sized=!0,i.build()}var a=o.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(o.navigator.userAgent);if(!t.naturalWidth||a){var n=document.createElement("img"),r=document.body||document.documentElement;(this.sizingImage=n).onload=function(){e(n.width,n.height),a||r.removeChild(n)},n.src=t.src,a||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",r.appendChild(n))}else e(t.naturalWidth,t.naturalHeight)}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var t=this.element,e=this.options,i=this.image,a=t.parentNode,n=document.createElement("div");n.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var r=n.querySelector(".".concat(l,"-container")),o=r.querySelector(".".concat(l,"-canvas")),s=r.querySelector(".".concat(l,"-drag-box")),h=r.querySelector(".".concat(l,"-crop-box")),c=h.querySelector(".".concat(l,"-face"));this.container=a,this.cropper=r,this.canvas=o,this.dragBox=s,this.cropBox=h,this.viewBox=r.querySelector(".".concat(l,"-view-box")),this.face=c,o.appendChild(i),tt(t,M),a.insertBefore(r,t.nextSibling),this.isImg||et(i,u),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,tt(h,M),e.guides||tt(h.getElementsByClassName("".concat(l,"-dashed")),M),e.center||tt(h.getElementsByClassName("".concat(l,"-center")),M),e.background&&tt(r,"".concat(l,"-bg")),e.highlight||tt(c,d),e.cropBoxMovable&&(tt(c,p),ot(c,g,"all")),e.cropBoxResizable||(tt(h.getElementsByClassName("".concat(l,"-line")),M),tt(h.getElementsByClassName("".concat(l,"-point")),M)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),X(e.ready)&&lt(t,"ready",e.ready,{once:!0}),ut(t,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),et(this.element,M))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Qt,i}},{key:"setDefaults",value:function(t){$(R,j(t)&&t)}}]),i}();return $(Dt.prototype,Ct,Bt,xt,Et,_t,Mt),Dt},"object"==typeof i&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define(n):(a=a||self).Cropper=n()},{}],3:[function(t,e,i){var s,h,c,l,u,d;function p(t,e,i,a,n,r){var o,s,h,c,l,u,d,p,g,f,m,A,v,w;for(g=0;g<r;g++){for(p=0,c=l=(o=t[u=(d=g)*n])*a[6],m=a[0],A=a[1],v=a[4],w=a[5],f=0;f<n;f++)h=(s=t[u])*m+o*A+c*v+l*w,l=c,c=h,o=s,i[p]=c,p++,u++;for(p--,d+=r*(n-1),c=l=(o=t[--u])*a[7],s=o,m=a[2],A=a[3],f=n-1;0<=f;f--)h=s*m+o*A+c*v+l*w,l=c,c=h,o=s,s=t[u],e[d]=i[p]+c,u--,p--,d-=r}}e.exports=function(t,e,i,a){if(a){var n=new Uint16Array(t.length),r=new Float32Array(Math.max(e,i)),o=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,i=Math.exp(-e),a=Math.exp(-2*e),n=(1-i)*(1-i)/(1+2*e*i-a);return h=(s=n)*(e-1)*i,c=n*(1+e)*i,l=-n*a,u=2*i,d=-a,new Float32Array([s,h,c,l,u,d,(s+h)/(1-u-d),(c+l)/(1-u-d)])}(a);p(t,n,r,o,e,i),p(n,t,r,o,i,e)}}},{}],4:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){if(e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},{}],5:[function(t,e,i){"use strict";var r=t("object-assign"),a=t("./lib/base64decode"),n=t("./lib/wa_detect"),o={js:!0,wasm:!0};function s(t){if(!(this instanceof s))return new s(t);var e=r({},o,t||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}s.prototype.has_wasm=n,s.prototype.use=function(t){return this.__modules[t.name]=t,this.options.wasm&&this.has_wasm()&&t.wasm_fn?this[t.name]=t.wasm_fn:this[t.name]=t.fn,this},s.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var i=this;return this.__init_promise=Promise.all(Object.keys(i.__modules).map(function(e){var t=i.__modules[e];return i.options.wasm&&i.has_wasm()&&t.wasm_fn?i.__wasm[e]?null:WebAssembly.compile(i.__base64decode(t.wasm_src)).then(function(t){i.__wasm[e]=t}):null})).then(function(){return i}),this.__init_promise},s.prototype.__base64decode=a,s.prototype.__reallocate=function(t){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(t/65536)}),this.__memory;var e=this.__memory.buffer.byteLength;return e<t&&this.__memory.grow(Math.ceil((t-e)/65536)),this.__memory},s.prototype.__instance=function(t,e,i){if(e&&this.__reallocate(e),!this.__wasm[t]){var a=this.__modules[t];this.__wasm[t]=new WebAssembly.Module(this.__base64decode(a.wasm_src))}if(!this.__cache[t]){var n={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[t]=new WebAssembly.Instance(this.__wasm[t],{env:r(n,i||{})})}return this.__cache[t]},s.prototype.__align=function(t,e){var i=t%(e=e||8);return t+(i?e-i:0)},e.exports=s},{"./lib/base64decode":6,"./lib/wa_detect":12,"object-assign":13}],6:[function(t,e,i){"use strict";e.exports=function(t){for(var e=t.replace(/[\r\n=]/g,""),i=e.length,a=new Uint8Array(3*i>>2),n=0,r=0,o=0;o<i;o++)o%4==0&&o&&(a[r++]=n>>16&255,a[r++]=n>>8&255,a[r++]=255&n),n=n<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(o));var s=i%4*6;return 0==s?(a[r++]=n>>16&255,a[r++]=n>>8&255,a[r++]=255&n):18==s?(a[r++]=n>>10&255,a[r++]=n>>2&255):12==s&&(a[r++]=n>>4&255),a}},{}],7:[function(t,e,i){"use strict";e.exports=function(t,e,i){for(var a,n,r,o,s,h=e*i,c=new Uint16Array(h),l=0;l<h;l++)a=t[4*l],n=t[4*l+1],r=t[4*l+2],s=n<=a&&r<=a?a:r<=n&&a<=n?n:r,o=a<=n&&a<=r?a:n<=r&&n<=a?n:r,c[l]=257*(s+o)>>1;return c}},{}],8:[function(t,e,i){"use strict";e.exports={name:"unsharp_mask",fn:t("./unsharp_mask"),wasm_fn:t("./unsharp_mask_wasm"),wasm_src:t("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":9,"./unsharp_mask_wasm":10,"./unsharp_mask_wasm_base64":11}],9:[function(t,e,i){"use strict";var x=t("glur/mono16"),E=t("./hsl_l16");e.exports=function(t,e,i,a,n,r){var o,s,h,c,l,u,d,p,g,f,m,A,v;if(!(0===a||n<.5)){2<n&&(n=2);var w=E(t,e,i),b=new Uint16Array(w);x(b,e,i,n);for(var y=a/100*4096+.5|0,I=257*r|0,C=e*i,B=0;B<C;B++)A=2*(w[B]-b[B]),Math.abs(A)>=I&&(o=t[v=4*B],s=t[1+v],h=t[2+v],u=257*((p=s<=o&&h<=o?o:o<=s&&h<=s?s:h)+(d=o<=s&&o<=h?o:s<=o&&s<=h?s:h))>>1,c=d===p?l=0:(l=u<=32767?4095*(p-d)/(p+d)|0:4095*(p-d)/(510-p-d)|0,o===p?65535*(s-h)/(6*(p-d))|0:s===p?21845+(65535*(h-o)/(6*(p-d))|0):43690+(65535*(o-s)/(6*(p-d))|0)),65535<(u+=y*A+2048>>12)?u=65535:u<0&&(u=0),0===l?o=s=h=u>>8:(g=2*u-(f=u<=32767?u*(4096+l)+2048>>12:u+((65535-u)*l+2048>>12))>>8,f>>=8,o=43690<=(m=c+21845&65535)?g:32767<=m?g+(6*(f-g)*(43690-m)+32768>>16):10922<=m?f:g+(6*(f-g)*m+32768>>16),s=43690<=(m=65535&c)?g:32767<=m?g+(6*(f-g)*(43690-m)+32768>>16):10922<=m?f:g+(6*(f-g)*m+32768>>16),h=43690<=(m=c-21845&65535)?g:32767<=m?g+(6*(f-g)*(43690-m)+32768>>16):10922<=m?f:g+(6*(f-g)*m+32768>>16)),t[v]=o,t[1+v]=s,t[2+v]=h)}}},{"./hsl_l16":7,"glur/mono16":3}],10:[function(t,e,i){"use strict";e.exports=function(t,e,i,a,n,r){if(!(0===a||n<.5)){2<n&&(n=2);var o=e*i,s=4*o,h=2*o,c=2*o,l=4*Math.max(e,i),u=s,d=u+h,p=d+c,g=p+c,f=g+l,m=this.__instance("unsharp_mask",s+h+2*c+l+32,{exp:Math.exp}),A=new Uint32Array(t.buffer);new Uint32Array(this.__memory.buffer).set(A);var v=m.exports.hsl_l16||m.exports._hsl_l16;v(0,u,e,i),(v=m.exports.blurMono16||m.exports._blurMono16)(u,d,p,g,f,e,i,n),(v=m.exports.unsharp||m.exports._unsharp)(0,0,u,d,e,i,a,r),A.set(new Uint32Array(this.__memory.buffer,0,o))}}},{}],11:[function(t,e,i){"use strict";e.exports="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"},{}],12:[function(t,e,i){"use strict";var a;e.exports=function(){if(void 0!==a)return a;if(a=!1,"undefined"==typeof WebAssembly)return a;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),e=new WebAssembly.Module(t);return 0!==new WebAssembly.Instance(e,{}).exports.test(4)&&(a=!0),a}catch(t){}return a}},{}],13:[function(t,e,i){"use strict";var h=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(t){a[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,a,n=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),r=1;r<arguments.length;r++){for(var o in i=Object(arguments[r]))c.call(i,o)&&(n[o]=i[o]);if(h){a=h(i);for(var s=0;s<a.length;s++)l.call(i,a[s])&&(n[a[s]]=i[a[s]])}}return n}},{}],14:[function(r,t,e){"use strict";function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=[],a=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){n=!0,r=t}finally{try{a||null==s.return||s.return()}finally{if(n)throw r}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var A=r("object-assign"),i=r("webworkify"),o=r("./lib/mathlib"),s=r("./lib/pool"),v=r("./lib/utils"),a=r("./lib/worker"),h=r("./lib/stepper"),w=r("./lib/tiler"),c={},b=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(b=0<=navigator.userAgent.indexOf("Safari"))}catch(t){}var n=1;"undefined"!=typeof navigator&&(n=Math.min(navigator.hardwareConcurrency||1,4));var y,I,l={tile:1024,concurrency:n,features:["js","wasm","ww"],idle:2e3},u={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};function d(){return{value:i(a),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function p(t){if(!(this instanceof p))return new p(t);this.options=A({},l,t||{});var e="lk_".concat(this.options.concurrency);this.__limit=c[e]||v.limiter(this.options.concurrency),c[e]||(c[e]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}p.prototype.init=function(){var e=this;if(this.__initPromise)return this.__initPromise;if(!1!==y&&!0!==y&&(y=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),y=!0}catch(t){}!1!==I&&!0!==I&&(I=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?I=!0:this.debug("ImageBitmap does not support .close(), disabled")));var i=this.options.features.slice();if(0<=i.indexOf("all")&&(i=["cib","wasm","js","ww"]),this.__requested_features=i,this.__mathlib=new o(i),0<=i.indexOf("ww")&&"undefined"!=typeof window&&"Worker"in window)try{r("webworkify")(function(){}).terminate(),this.features.ww=!0;var t="wp_".concat(JSON.stringify(this.options));c[t]?this.__workersPool=c[t]:(this.__workersPool=new s(d,this.options.idle),c[t]=this.__workersPool)}catch(t){}var a,n=this.__mathlib.init().then(function(t){A(e.features,t.features)});return a=I?v.cib_support().then(function(t){e.features.cib&&i.indexOf("cib")<0?e.debug("createImageBitmap() resize supported, but disabled by config"):0<=i.indexOf("cib")&&(e.features.cib=t)}):Promise.resolve(!1),this.__initPromise=Promise.all([n,a]).then(function(){return e}),this.__initPromise},p.prototype.resize=function(t,r,e){var d=this;this.debug("Start resize...");var o=A({},u);if(isNaN(e)?e&&(o=A(o,e)):o=A(o,{quality:e}),o.toWidth=r.width,o.toHeight=r.height,o.width=t.naturalWidth||t.width,o.height=t.naturalHeight||t.height,0===r.width||0===r.height)return Promise.reject(new Error("Invalid output size: ".concat(r.width,"x").concat(r.height)));2<o.unsharpRadius&&(o.unsharpRadius=2);var p=!1,g=null;o.cancelToken&&(g=o.cancelToken.then(function(t){throw p=!0,t},function(t){throw p=!0,t}));var f=Math.ceil(Math.max(3,2.5*o.unsharpRadius|0));return this.init().then(function(){if(p)return g;if(d.features.cib){var n=r.getContext("2d",{alpha:Boolean(o.alpha)});return d.debug("Resize via createImageBitmap()"),createImageBitmap(t,{resizeWidth:o.toWidth,resizeHeight:o.toHeight,resizeQuality:v.cib_quality_name(o.quality)}).then(function(t){if(p)return g;if(!o.unsharpAmount)return n.drawImage(t,0,0),t.close(),n=null,d.debug("Finished!"),r;d.debug("Unsharp result");var e=document.createElement("canvas");e.width=o.toWidth,e.height=o.toHeight;var i=e.getContext("2d",{alpha:Boolean(o.alpha)});i.drawImage(t,0,0),t.close();var a=i.getImageData(0,0,o.toWidth,o.toHeight);return d.__mathlib.unsharp_mask(a.data,o.toWidth,o.toHeight,o.unsharpAmount,o.unsharpRadius,o.unsharpThreshold),n.putImageData(a,0,0),a=i=e=n=null,d.debug("Finished!"),r})}function l(r,i,o){function a(n){return d.__limit(function(){if(p)return g;var a;if(v.isCanvas(r))d.debug("Get tile pixel data"),a=s.getImageData(n.x,n.y,n.width,n.height);else{d.debug("Draw tile imageBitmap/image to temporary canvas");var t=document.createElement("canvas");t.width=n.width,t.height=n.height;var e=t.getContext("2d",{alpha:Boolean(o.alpha)});e.globalCompositeOperation="copy",e.drawImage(h||r,n.x,n.y,n.width,n.height,0,0,n.width,n.height),d.debug("Get tile pixel data"),a=e.getImageData(0,0,n.width,n.height),e=t=null}var i={src:a.data,width:n.width,height:n.height,toWidth:n.toWidth,toHeight:n.toHeight,scaleX:n.scaleX,scaleY:n.scaleY,offsetX:n.offsetX,offsetY:n.offsetY,quality:o.quality,alpha:o.alpha,unsharpAmount:o.unsharpAmount,unsharpRadius:o.unsharpRadius,unsharpThreshold:o.unsharpThreshold};return d.debug("Invoke resize math"),Promise.resolve().then(function(){return function(t){return Promise.resolve().then(function(){return d.features.ww?new Promise(function(e,i){var a=d.__workersPool.acquire();g&&g.catch(function(t){return i(t)}),a.value.onmessage=function(t){a.release(),t.data.err?i(t.data.err):e(t.data.result)},a.value.postMessage({opts:t,features:d.__requested_features,preload:{wasm_nodule:d.__mathlib.__}},[t.src.buffer])}):d.__mathlib.resizeAndUnsharp(t,u)})}(i)}).then(function(t){if(p)return g;var e;if(a=null,d.debug("Convert raw rgba tile result to ImageData"),y)e=new ImageData(new Uint8ClampedArray(t),n.toWidth,n.toHeight);else if((e=c.createImageData(n.toWidth,n.toHeight)).data.set)e.data.set(t);else for(var i=e.data.length-1;0<=i;i--)e.data[i]=t[i];return d.debug("Draw tile"),b?c.putImageData(e,n.toX,n.toY,n.toInnerX-n.toX,n.toInnerY-n.toY,n.toInnerWidth+1e-5,n.toInnerHeight+1e-5):c.putImageData(e,n.toX,n.toY,n.toInnerX-n.toX,n.toInnerY-n.toY,n.toInnerWidth,n.toInnerHeight),null})})}var s,h,c;return Promise.resolve().then(function(){if(c=i.getContext("2d",{alpha:Boolean(o.alpha)}),v.isCanvas(r))return s=r.getContext("2d",{alpha:Boolean(o.alpha)}),null;if(v.isImage(r))return I?(d.debug("Decode image via createImageBitmap"),createImageBitmap(r).then(function(t){h=t})):null;throw new Error('".from" should be image or canvas')}).then(function(){if(p)return g;d.debug("Calculate tiles");var t=w({width:o.width,height:o.height,srcTileSize:d.options.tile,toWidth:o.toWidth,toHeight:o.toHeight,destTileBorder:f}).map(function(t){return a(t)});function e(){h&&(h.close(),h=null)}return d.debug("Process tiles"),Promise.all(t).then(function(){return d.debug("Finished!"),e(),i},function(t){throw e(),t})})}var u={};return function t(e,i,a,n){if(p)return g;var r,o=m(e.shift(),2),s=o[0],h=o[1],c=0===e.length;return n=A({},n,{toWidth:s,toHeight:h,quality:c?n.quality:Math.min(1,n.quality)}),c||((r=document.createElement("canvas")).width=s,r.height=h),l(i,c?a:r,n).then(function(){return c?a:(n.width=s,n.height=h,t(e,r,a,n))})}(h(o.width,o.height,o.toWidth,o.toHeight,d.options.tile,f),t,r,o)})},p.prototype.resizeBuffer=function(t){var e=this,i=A({},u,t);return this.init().then(function(){return e.__mathlib.resizeAndUnsharp(i)})},p.prototype.toBlob=function(r,o,s){return o=o||"image/png",new Promise(function(e){if(r.toBlob)r.toBlob(function(t){return e(t)},o,s);else{for(var t=atob(r.toDataURL(o,s).split(",")[1]),i=t.length,a=new Uint8Array(i),n=0;n<i;n++)a[n]=t.charCodeAt(n);e(new Blob([a],{type:o}))}})},p.prototype.debug=function(){},t.exports=p},{"./lib/mathlib":15,"./lib/pool":23,"./lib/stepper":24,"./lib/tiler":25,"./lib/utils":26,"./lib/worker":27,"object-assign":13,webworkify:28}],15:[function(t,e,i){"use strict";var a=t("inherits"),n=t("multimath"),r=t("multimath/lib/unsharp_mask"),o=t("./mm_resize");function s(t){var e=t||[],i={js:0<=e.indexOf("js"),wasm:0<=e.indexOf("wasm")};n.call(this,i),this.features={js:i.js,wasm:i.wasm&&this.has_wasm()},this.use(r),this.use(o)}a(s,n),s.prototype.resizeAndUnsharp=function(t,e){var i=this.resize(t,e);return t.unsharpAmount&&this.unsharp_mask(i,t.toWidth,t.toHeight,t.unsharpAmount,t.unsharpRadius,t.unsharpThreshold),i},e.exports=s},{"./mm_resize":18,inherits:4,multimath:5,"multimath/lib/unsharp_mask":8}],16:[function(t,e,i){"use strict";function w(t){return t<0?0:255<t?255:t}e.exports={convolveHorizontally:function(t,e,i,a,n,r){var o,s,h,c,l,u,d,p,g,f,m,A=0,v=0;for(g=0;g<a;g++){for(f=l=0;f<n;f++){for(u=r[l++],d=r[l++],p=A+4*u|0,o=s=h=c=0;0<d;d--)c=c+(m=r[l++])*t[p+3]|0,h=h+m*t[p+2]|0,s=s+m*t[p+1]|0,o=o+m*t[p]|0,p=p+4|0;e[v+3]=w(c+8192>>14),e[v+2]=w(h+8192>>14),e[v+1]=w(s+8192>>14),e[v]=w(o+8192>>14),v=v+4*a|0}v=4*(g+1)|0,A=(g+1)*i*4|0}},convolveVertically:function(t,e,i,a,n,r){var o,s,h,c,l,u,d,p,g,f,m,A=0,v=0;for(g=0;g<a;g++){for(f=l=0;f<n;f++){for(u=r[l++],d=r[l++],p=A+4*u|0,o=s=h=c=0;0<d;d--)c=c+(m=r[l++])*t[p+3]|0,h=h+m*t[p+2]|0,s=s+m*t[p+1]|0,o=o+m*t[p]|0,p=p+4|0;e[v+3]=w(c+8192>>14),e[v+2]=w(h+8192>>14),e[v+1]=w(s+8192>>14),e[v]=w(o+8192>>14),v=v+4*a|0}v=4*(g+1)|0,A=(g+1)*i*4|0}}}},{}],17:[function(t,e,i){"use strict";e.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],18:[function(t,e,i){"use strict";e.exports={name:"resize",fn:t("./resize"),wasm_fn:t("./resize_wasm"),wasm_src:t("./convolve_wasm_base64")}},{"./convolve_wasm_base64":17,"./resize":19,"./resize_wasm":22}],19:[function(t,e,i){"use strict";var m=t("./resize_filter_gen"),A=t("./convolve").convolveHorizontally,v=t("./convolve").convolveVertically;e.exports=function(t){var e=t.src,i=t.width,a=t.height,n=t.toWidth,r=t.toHeight,o=t.scaleX||t.toWidth/t.width,s=t.scaleY||t.toHeight/t.height,h=t.offsetX||0,c=t.offsetY||0,l=t.dest||new Uint8Array(n*r*4),u=void 0===t.quality?3:t.quality,d=t.alpha||!1,p=m(u,i,n,o,h),g=m(u,a,r,s,c),f=new Uint8Array(n*a*4);return A(e,f,i,a,n,p),v(f,l,a,n,r,g),d||function(t,e,i){for(var a=3,n=e*i*4|0;a<n;)t[a]=255,a=a+4|0}(l,n,r),l}},{"./convolve":16,"./resize_filter_gen":20}],20:[function(t,e,i){"use strict";var D=t("./resize_filter_info"),a=14;function k(t){return Math.round(t*((1<<a)-1))}e.exports=function(t,e,i,a,n){var r,o,s,h,c,l,u,d,p,g,f,m,A,v,w,b,y,I=D[t].filter,C=1/a,B=Math.min(1,a),x=D[t].win/B,E=Math.floor(2*(1+x)),_=new Int16Array((E+2)*i),M=0,Q=!_.subarray||!_.set;for(r=0;r<i;r++){for(o=(r+.5)*C+n,s=Math.max(0,Math.floor(o-x)),c=(h=Math.min(e-1,Math.ceil(o+x)))-s+1,l=new Float32Array(c),u=new Int16Array(c),p=s,g=d=0;p<=h;p++,g++)d+=f=I((p+.5-o)*B),l[g]=f;for(g=m=0;g<l.length;g++)m+=A=l[g]/d,u[g]=k(A);for(u[i>>1]+=k(1-m),v=0;v<u.length&&0===u[v];)v++;if(v<u.length){for(w=u.length-1;0<w&&0===u[w];)w--;if(b=s+v,y=w-v+1,_[M++]=b,_[M++]=y,Q)for(g=v;g<=w;g++)_[M++]=u[g];else _.set(u.subarray(v,w+1),M),M+=y}else _[M++]=0,_[M++]=0}return _}},{"./resize_filter_info":21}],21:[function(t,e,i){"use strict";e.exports=[{win:.5,filter:function(t){return-.5<=t&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||1<=t)return 0;if(-1.1920929e-7<t&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||2<=t)return 0;if(-1.1920929e-7<t&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||3<=t)return 0;if(-1.1920929e-7<t&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}]},{}],22:[function(t,e,i){"use strict";var C=t("./resize_filter_gen");var o=!0;try{o=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(t){}function B(t,e,i){if(o)e.set(function(t){return new Uint8Array(t.buffer,0,t.byteLength)}(t),i);else for(var a=i,n=0;n<t.length;n++){var r=t[n];e[a++]=255&r,e[a++]=r>>8&255}}e.exports=function(t){var e=t.src,i=t.width,a=t.height,n=t.toWidth,r=t.toHeight,o=t.scaleX||t.toWidth/t.width,s=t.scaleY||t.toHeight/t.height,h=t.offsetX||0,c=t.offsetY||0,l=t.dest||new Uint8Array(n*r*4),u=void 0===t.quality?3:t.quality,d=t.alpha||!1,p=C(u,i,n,o,h),g=C(u,a,r,s,c),f=this.__align(0+Math.max(e.byteLength,l.byteLength)),m=this.__align(f+a*n*4),A=this.__align(m+p.byteLength),v=A+g.byteLength,w=this.__instance("resize",v),b=new Uint8Array(this.__memory.buffer),y=new Uint32Array(this.__memory.buffer),I=new Uint32Array(e.buffer);return y.set(I),B(p,b,m),B(g,b,A),(w.exports.convolveHV||w.exports._convolveHV)(m,A,f,i,a,n,r),new Uint32Array(l.buffer).set(new Uint32Array(this.__memory.buffer,0,r*n)),d||function(t,e,i){for(var a=3,n=e*i*4|0;a<n;)t[a]=255,a=a+4|0}(l,n,r),l}},{"./resize_filter_gen":20}],23:[function(t,e,i){"use strict";function a(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}a.prototype.acquire=function(){var t,e=this;return 0!==this.available.length?t=this.available.pop():((t=this.create()).id=this.lastId++,t.release=function(){return e.release(t)}),this.acquired[t.id]=t},a.prototype.release=function(t){var e=this;delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return e.gc()},100))},a.prototype.gc=function(){var e=this,i=Date.now();this.available=this.available.filter(function(t){return!(i-t.lastUsed>e.idle)||(t.destroy(),!1)}),0!==this.available.length?this.timeoutId=setTimeout(function(){return e.gc()},100):this.timeoutId=0},e.exports=a},{}],24:[function(t,e,i){"use strict";e.exports=function(t,e,i,a,n,r){var o=i/t,s=a/e,h=(2*r+2+1)/n;if(.5<h)return[[i,a]];var c=Math.ceil(Math.log(Math.min(o,s))/Math.log(h));if(c<=1)return[[i,a]];for(var l=[],u=0;u<c;u++){var d=Math.round(Math.pow(Math.pow(t,c-u-1)*Math.pow(i,u+1),1/c)),p=Math.round(Math.pow(Math.pow(e,c-u-1)*Math.pow(a,u+1),1/c));l.push([d,p])}return l}},{}],25:[function(t,e,i){"use strict";var a=1e-5;function p(t){var e=Math.round(t);return Math.abs(t-e)<a?e:Math.floor(t)}function g(t){var e=Math.round(t);return Math.abs(t-e)<a?e:Math.ceil(t)}e.exports=function(t){var e,i,a,n,r,o,s=t.toWidth/t.width,h=t.toHeight/t.height,c=p(t.srcTileSize*s)-2*t.destTileBorder,l=p(t.srcTileSize*h)-2*t.destTileBorder;if(c<1||l<1)throw new Error("Internal error in pica: target tile width/height is too small.");var u,d=[];for(n=0;n<t.toHeight;n+=l)for(a=0;a<t.toWidth;a+=c)(e=a-t.destTileBorder)<0&&(e=0),e+(r=a+c+t.destTileBorder-e)>=t.toWidth&&(r=t.toWidth-e),(i=n-t.destTileBorder)<0&&(i=0),i+(o=n+l+t.destTileBorder-i)>=t.toHeight&&(o=t.toHeight-i),u={toX:e,toY:i,toWidth:r,toHeight:o,toInnerX:a,toInnerY:n,toInnerWidth:c,toInnerHeight:l,offsetX:e/s-p(e/s),offsetY:i/h-p(i/h),scaleX:s,scaleY:h,x:p(e/s),y:p(i/h),width:g(r/s),height:g(o/h)},d.push(u);return d}},{}],26:[function(t,e,i){"use strict";function a(t){return Object.prototype.toString.call(t)}e.exports.isCanvas=function(t){var e=a(t);return"[object HTMLCanvasElement]"===e||"[object Canvas]"===e},e.exports.isImage=function(t){return"[object HTMLImageElement]"===a(t)},e.exports.limiter=function(t){var a=0,n=[];function r(){a<t&&n.length&&(a++,n.shift()())}return function(t){return new Promise(function(e,i){n.push(function(){t().then(function(t){e(t),a--,r()},function(t){i(t),a--,r()})}),r()})}},e.exports.cib_quality_name=function(t){switch(t){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},e.exports.cib_support=function(){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;var i=document.createElement("canvas");return i.width=100,i.height=100,createImageBitmap(i,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(t){var e=10===t.width;return t.close(),i=null,e})}).catch(function(){return!1})}},{}],27:[function(t,e,i){"use strict";e.exports=function(){var a,n=t("./mathlib");onmessage=function(t){var e=t.data.opts,i=(a=a||new n(t.data.features)).resizeAndUnsharp(e);postMessage({result:i},[i.buffer])}}},{"./mathlib":15}],28:[function(t,e,i){var A=arguments[3],v=arguments[4],w=arguments[5],b=JSON.stringify;e.exports=function(t,e){for(var i,a=Object.keys(w),n=0,r=a.length;n<r;n++){var o=a[n],s=w[o].exports;if(s===t||s&&s.default===t){i=o;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};for(n=0,r=a.length;n<r;n++){h[o=a[n]]=o}v[i]=["function(require,module,exports){"+t+"(self); }",h]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),l={};l[i]=i,v[c]=["function(require,module,exports){var f = require("+b(i)+");(f.default ? f.default : f)(self);}",l];var u={};!function t(e){u[e]=!0;for(var i in v[e][1]){var a=v[e][1][i];u[a]||t(a)}}(c);var d="("+A+")({"+Object.keys(u).map(function(t){return b(t)+":["+v[t][0]+","+b(v[t][1])+"]"}).join(",")+"},{},["+b(c)+"])",p=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([d],{type:"text/javascript"});if(e&&e.bare)return g;var f=p.createObjectURL(g),m=new Worker(f);return m.objectURL=f,m}},{}]},{},[1]);