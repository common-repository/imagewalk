!function a(r,d,u){function l(t,e){if(!d[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=d[t]={exports:{}};r[t][0].call(i.exports,function(e){return l(r[t][1][e]||e)},i,i.exports,a,r,d,u)}return d[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,t,n){(function(e){"use strict";var i="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null,t="undefined"!=typeof window?window.imagewalk_data:void 0!==e?e.imagewalk_data:null;function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=t.ajax_url,n=function(){function o(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=(0,i.$)(e);this.id=+n.data("id"),this.$elem=n,this.$toggle=n.find("[data-btn=actions]"),this.$dropdown=n.find("[data-dropdown=actions]"),this.$toggle.on("click",function(){return t.toggle()}),this.$dropdown.on("click",function(e){return t.onActions(e)})}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(o,[{key:"delete",value:function(){var o=this;return new Promise(function(e,t){var n;i.ajax.post({url:r,data:{action:"imagewalk_delete_comment",id:o.id},success:function(e){return n=JSON.parse(e)},complete:function(){n&&n.success?(o.$elem.remove(),i.hooks.doAction("comment_deleted",o.id),e(n)):t(n&&n.error||"")}})})}},{key:"show",value:function(){var e=this;this.$dropdown.display("block"),setTimeout(function(){e.autohide=function(){return e.hide()},(0,i.$)(document).on("click",e.autohide)},100)}},{key:"hide",value:function(){this.$dropdown.display(""),this.autohide&&((0,i.$)(document).off("click",this.autohide),delete this.autohide)}},{key:"toggle",value:function(){"none"===this.$dropdown.display()?this.show():this.hide()}},{key:"onActions",value:function(e){e.preventDefault(),"A"!==e.target.tagName||"action-delete"===(0,i.$)(e.target).data("btn")&&confirm(t.comment.lang.delete)&&this.delete().catch(function(e){return e&&alert(e)});this.hide()}}]),o}();i.hooks.addAction("comment_render","comment",function(e){new n(e)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){(function(e){"use strict";var a="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null;function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=("undefined"!=typeof window?window.imagewalk_data:void 0!==e?e.imagewalk_data:null).ajax_url,o=function(){function o(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.id=e,this.$elem=(0,a.$)(t),this.$input=this.$elem.find("input"),this.$button=this.$elem.find("button"),this.$button.on("click",function(){return n.onSubmit()}),a.device.isTouch()||this.$input.on("keydown",function(e){return n.onKeydown(e)})}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(o,[{key:"post",value:function(o){var i=this;return new Promise(function(e,t){var n;a.ajax.post({url:r,data:{action:"imagewalk_add_comment",id:i.id,content:o},success:function(e){(n=JSON.parse(e))&&n.success},complete:function(){n&&n.success?(a.hooks.doAction("comment_added",i.id,n.data),e(n)):t(n&&n.error||"")}})})}},{key:"onSubmit",value:function(){var e=this,t=this.$input.val().trim();t&&(this.$input.prop("disabled",!0),this.$button.prop("disabled",!0),this.post(t).then(function(){return e.$input.val("")}).catch(function(e){return alert(e)}).then(function(){e.$input.prop("disabled",!1),e.$button.prop("disabled",!1)}))}},{key:"onKeydown",value:function(e){13===e.keyCode&&(e.preventDefault(),this.onSubmit())}}]),o}();a.hooks.addAction("post_render","commentbox",function(e){var t,n=e.querySelector(".imgw-commentbox");n&&(t=e.getAttribute("data-id"),new o(t,n))})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){(function(e){"use strict";var r="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null,t="undefined"!=typeof window?window.imagewalk_data:void 0!==e?e.imagewalk_data:null;function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var n=t.ajax_url,d=+t.comments.more,o=function(){function o(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.id=e,this.$elem=(0,r.$)(t),this.$more=this.$elem.find(".imgw-comments__more"),this.$moreTrigger=this.$more.find("[data-btn=more]"),this.$moreTrigger.on("click",function(e){return n.onCommentsMore(e)}),r.hooks.addAction("comment_added","comments",function(e,t){return n.onCommentAdded(e,t)}),this.$elem.find(".imgw-comment").each(function(e){r.hooks.doAction("comment_render",e)})}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(o,[{key:"render",value:function(e,t){var n=this,o="prepend"===t,i=null;e&&e.forEach&&(o&&(i=this.$more.get(0).nextElementSibling),e.forEach(function(e){var t=r.comment.toElement(e);n.$elem.get(0).insertBefore(t,o?i:null),r.hooks.doAction("comment_render",t)}))}},{key:"onCommentsMore",value:function(e){var a=this;if(e.preventDefault(),e.stopPropagation(),!this._fetching&&(this.$first=this.$elem.find(".imgw-comment"),this.$first.length)){var t=this.$first.data("id");this._fetching=!0,r.ajax.get({url:n,data:{action:"imagewalk_get_comments",post_id:this.id,limit:d,ref:"<".concat(t)},success:function(e){var t=JSON.parse(e);if(t&&t.data){var n=t.data,o=n.items,i=n.more;o&&o.length&&a.render(t.data.items,"prepend"),i||a.$more.display("none")}},complete:function(){a._fetching=!1}})}}},{key:"onCommentAdded",value:function(e,t){if(e===this.id){var n=r.comment.toElement(t);this.$elem.get(0).appendChild(n),r.hooks.doAction("comment_render",n)}}}]),o}();r.hooks.addAction("post_render","comments",function(e){var t,n=e.querySelector(".imgw-comments");n&&(t=e.getAttribute("data-id"),new o(t,n))})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){(function(e){"use strict";var t="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null;function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.$elem=e,this.$upload=e.querySelector("[data-btn=upload]"),this.$upload&&this.$upload.addEventListener("click",function(e){return t.onUpload(e)})}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(n,[{key:"onUpload",value:function(e){e.preventDefault(),e.stopPropagation(),t.hooks.doAction("upload_open")}}]),n}();t.hooks.addAction("init","init_menubar",function(){n(document.querySelectorAll(".imgw-menubar")).forEach(function(e){new i(e)})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){(function(e){"use strict";var a="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null,t="undefined"!=typeof window?window.imagewalk_data:void 0!==e?e.imagewalk_data:null;function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r=t.ajax_url,n=function(){function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var n=(0,a.$)(e),o=n.find(".imgw-post__header");this.id=+n.data("id"),this.$elem=n,this.$toggle=o.find("[data-btn=actions]"),this.$dropdown=o.find("[data-dropdown=actions]"),this.$toggle.on("click",function(){return t.toggle()}),this.$dropdown.on("click",function(e){return t.onActions(e)})}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(i,[{key:"delete",value:function(){var o=this;return new Promise(function(e,t){var n;a.ajax.post({url:r,data:{action:"imagewalk_delete_post",id:o.id},success:function(e){return n=JSON.parse(e)},complete:function(){n&&n.success?(o.$elem.remove(),a.hooks.doAction("post_deleted",o.id),e(n)):t(n&&n.error||"")}})})}},{key:"show",value:function(){var e=this;this.$dropdown.display("block"),setTimeout(function(){e.autohide=function(){return e.hide()},(0,a.$)(document).on("click",e.autohide)},100)}},{key:"hide",value:function(){this.$dropdown.display(""),this.autohide&&((0,a.$)(document).off("click",this.autohide),delete this.autohide)}},{key:"toggle",value:function(){"none"===this.$dropdown.display()?this.show():this.hide()}},{key:"onActions",value:function(e){e.preventDefault(),"A"!==e.target.tagName||"action-delete"===(0,a.$)(e.target).data("btn")&&confirm(t.post.lang.delete)&&this.delete().catch(function(e){return e&&alert(e)});this.hide()}}]),i}();a.hooks.addAction("post_render","post",function(e){new n(e)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){(function(e){"use strict";var u="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null,t="undefined"!=typeof window?window.imagewalk_data:void 0!==e?e.imagewalk_data:null;function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var l=t.ajax_url,i=+t.posts.initial,a=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.id=+e.getAttribute("data-id"),this.mode=e.getAttribute("data-mode"),this.newest=null,this.oldest=null,this.$elem=e,this.$loading=e.querySelector("[data-element=spinner]"),this.getInitial(i).then(function(e){e&&e.length?t.autoload():t.$loading.style.display="none"}),u.hooks.addAction("upload_success","stream",function(){return t.onUploadSuccess()}),u.hooks.addAction("post_deleted","stream",function(){return t.onPostDeleted()})}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(n,[{key:"get",value:function(e,t){var a=this,r=0<arguments.length&&void 0!==e?e:1,d=1<arguments.length?t:void 0;return new Promise(function(e,t){var n,o=a.id||void 0,i=a.mode||void 0;u.ajax.get({url:l,data:{action:"imagewalk_get_posts",limit:r,user_id:o,mode:i,ref:d},success:function(e){var t=d&&d.match(/^>\d+$/);n=JSON.parse(e),a.render(n.data,t?"prepend":null)},complete:function(){void 0===n?t():e(n&&n.data)}})})}},{key:"getInitial",value:function(e){var t=0<arguments.length&&void 0!==e?e:1;return this.get(t)}},{key:"getOlder",value:function(e){var t=0<arguments.length&&void 0!==e?e:2;return this.get(t,"<".concat(this.oldest))}},{key:"getNewer",value:function(e){var t=0<arguments.length&&void 0!==e?e:10;return this.get(t,">".concat(this.newest))}},{key:"render",value:function(e,t){var n=this,o="prepend"===t,i=this.$loading;e&&e.forEach&&(o&&(i=this.$elem.firstChild),e.forEach(function(e){var t=u.post.toElement(e);n.$elem.insertBefore(t,i),n.newest=Math.max(n.newest||+e.id,+e.id),n.oldest=Math.min(n.oldest||+e.id,+e.id),i=o?t:i,u.hooks.doAction("post_render",t)}))}},{key:"autoload",value:function(){var t=this,e=u.fn.throttle(function(){t._autoloadEnd?window.removeEventListener("scroll",t.autoload):t._autoloadProgress?t.autoload():t.$elem.getBoundingClientRect().bottom<window.innerHeight&&(t._autoloadProgress=!0,t.getOlder().then(function(e){t._autoloadProgress=!1,e&&e.length||(t.$loading.style.display="none",t._autoloadEnd=!0)}))},500);this.autoload=e,this.autoload(),window.addEventListener("scroll",this.autoload)}},{key:"onUploadSuccess",value:function(){this.getNewer()}},{key:"onPostDeleted",value:function(){this.autoload()}}]),n}();u.hooks.addAction("init","init_stream",function(){n(document.querySelectorAll(".imgw-stream")).forEach(function(e){new a(e)})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(o,e,t){(function(e){"use strict";var t="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null;function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}o("./components/menubar"),o("./components/stream"),o("./components/comment"),o("./components/comments"),o("./components/commentbox"),o("./components/post"),o("./page"),t.hooks.addAction("init","init_trigger_upload",function(){n(document.querySelectorAll("[data-imagewalk=upload]")).forEach(function(e){e.addEventListener("click",function(){t.hooks.doAction("upload_open")})})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./components/comment":1,"./components/commentbox":2,"./components/comments":3,"./components/menubar":4,"./components/post":5,"./components/stream":6,"./page":8}],8:[function(e,t,n){"use strict";e("./post")},{"./post":9}],9:[function(e,t,n){(function(e){"use strict";var t="undefined"!=typeof window?window.imagewalk:void 0!==e?e.imagewalk:null;function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t.hooks.addAction("init","init_page_post",function(){n(document.querySelectorAll(".imgw-page--post")).forEach(function(e){e.querySelectorAll(".imgw-post").forEach(function(e){t.hooks.doAction("post_render",e)})})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[7]);